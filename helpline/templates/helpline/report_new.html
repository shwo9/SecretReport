{% extends 'core/layout.html' %}

{% load static %}

{% block style %}
<link rel="stylesheet" href="{% static 'helpline/css/report_new.css' %}" type="text/css" />
{% endblock %}


{% block content %}
<div id="content">
  <div class="container">
    <div id="process">
      <div class="process_item">
        <div class="process_index">1</div>
        <div class="process_detail">서비스<br>이용 동의</div>
      </div>
      <div class="process_border"></div>
      <div class="process_item">
        <div class="process_index">2</div>
        <div class="process_detail">본인인증</div>
      </div>
      <div class="process_border"></div>
      <div class="process_item">
        <div class="process_index">3</div>
        <div class="process_detail">신고서 작성</div>
      </div>
      <div class="process_border"></div>
      <div class="process_item">
        <div class="process_index">4</div>
        <div class="process_detail">변호사 선택</div>
      </div>
      <div class="process_border"></div>
      <div class="process_item">
        <div class="process_index">5</div>
        <div class="process_detail">수임 요청</div>
      </div>
    </div>

    <form method="POST" id="declare_form" style="width: 100%" enctype="multipart/form-data">
      {% csrf_token %}
      <!-- Step 1 -->
      <div id="step_1" class="process_content">
        <div class="step_title">
          <h1>Step 1. 서비스 이용 동의</h1>
          <div class="border"></div>
        </div>

        <div class="error"></div>

        <div class="form_notice_title">■ 개인정보 수집 및 이용 동의 ■</div>
        <div class="form_notice">
          <div class="form_title">1. 처리하는 개인정보의</div>
          <ul>
            <li>본 센터는 인권침해 및 성희롱· 성폭력 피해 처리 및 상담, 예방 및 교육을 위해 필요한 최소한의 개인정보만을 수집합니다.</li>
            <li>필수항목: 성명, 생년월일, 연령, 성별, 휴대폰번호, 소속(학과, 학년), 학번(사번), 내방경위, 상담신청</li>
            <li>선택항목: 이메일 주소, 현주소, 상담경험</li>
          </ul>

          <div class="form_title">2. 개인정보의 처리 목적</div>
          <ul>
            <li>본 센터는 수집한 개인정보를 다음의 목적을 위해 활용합니다.</li>
            <li>이용자가 제공한 모든 정보는 다음에 기술한 목적 이외에는 사용되지 않으며, 이용 목적이 변경될 시에는 사전 동의를 구할 것입니다.</li>
            <li>인권침해 및 성희롱·성폭력 피해 처리와 상담, 개인 면접 상담, 온라인 상담, 집단</li>
            <li>폭력 예방교육, 양성평등 교육의 정보</li>
            <li>행위자를 위한 성인지 향상 및 재발방지 교육상담</li>
          </ul>

          <div class="form_title">3. 개인정보의 처리 및 보유기간</div>
          <ul>
            <li>개인정보의 수집목적 또는 제공받은 목적이 달성된 때에는 귀하의 개인정보를 지체 없이 파기합니다.</li>
            <li>개인정보의 삭제 요구가 있는 경우 복구할 수 없는 방법으로 즉시 폐기</li>
          </ul>

          <div class="form_title">4. 개인정보 수집동의 거부권리 및 제한</div>
          <ul>
            <li>정보주체는 개인정보 수집·이용 동의를 거부하실 수 있으나 담당자의 기본정보가 제공되지 않거나 일부 누락되는 경우 상담 서비스가 제한될 수 있습니다.</li>

          </ul>
          <p style="color:red; text-align:center;">
            본 서비스는 익명을 기반으로한 인권신고 서비스입니다.<br>
            본인인증 시 인적사항은 암호화되어 저장되며 원본 인적사항은 저장되지 않습니다.<br>
            신고내용에 사실이 아닌 내용으로 무고, 협박, 명예훼손 등의 범죄 혐의가 밝혀질 경우<br>
            신원정보가 열람될 수 있으며 수사기관 요청에 따른 인적사항 열람이 가능할 수 있습니다.
          </p>
        </div>

        <div class="form_agreement">
          <div class="form_agreement_title">개인정보의 수집 및 이용목적에 동의하십니까?(필수)</div>
          <div class="form_agreement_body">
            <p>
              성균관대학교 인권센터는 수집한 민감정보를 인권침해·성폭력 피해 처리 및 상담의 목적으로 수집 및 활용하고 있습니다.<br>
            </p>
            <label>
              <input type="radio" name="agreement_1" value="1"> 동의
            </label>
            <label>
              <input type="radio" name="agreement_1" value="2"> 동의하지 않음
            </label>
          </div>
        </div>

        <div class="form_agreement">
          <div class="form_agreement_title">공익신고자의 신원정보 변호사 제공 동의 (필수)</div>
          <div class="form_agreement_body">
            <p>
              보다 신속하고, 정확한 사건처리를 위해 인권신고를 진행할 변호사에게만 인적사항을 공개하시겠습니까?<br>
              신고내용에 사실이 아닌 내용으로 무고, 협박, 명예훼손 등의 범죄 혐의가 밝혀질 경우<br>
              신원정보가 열람될 수 있으며 수사기관 요청에 따른 인적사항 열람이 가능할 수 있습니다.
            </p>
            <label>
              <input type="radio" name="agreement_2" value="1"> 동의
            </label>
            <label>
              <input type="radio" name="agreement_2" value="2"> 동의하지 않음
            </label>
          </div>
        </div>
      </div>

      <!-- Step 2 -->
      <div id="step_2" class="process_content">
        <div class="step_title">
          <h1>Step 2. 본인인증</h1>
          <div class="border"></div>
        </div>

        <div class="error"></div>

        <div class="form_certification">
          <table>
            <colgroup>
              <col sytle="width: 30%" />
              <col style="width: 70%" />
            </colgroup>
            <tr>
              <td>성명</td>
              <td><input type="text" name="name" /></td>
            </tr>
            <tr>
              <td>주민번호</td>
              <td><input type="text" name="rrn" id="rrn" /></td>
            </tr>
            <tr>
              <td>주소</td>
              <td style="display: flex">
                <div class="addressButton">
                  <button type="button" onclick="execDaumPostcode()">주소 찾기</button>
                </div>
                <div class="addressInput">
                  <input type="text" id="address" name="address" placeholder="주소" readonly />
                  <input type="text" id="detailAddress" name="detail_address" placeholder="상세주소" readonly />
                </div>
              </td>
            </tr>
            <tr>
              <td>연락처</td>
              <td><input type="text" name="phone" id="phone" /></td>
            </tr>
            <tr>
              <td colspan="2">
                <button class="sms_button" type="button" onclick="smsCertification()">SMS 본인인증</button>
              </td>
            </tr>
          </table>
          <br><br>
        </div>
      </div>

      <div id="step_3" class="process_content">
        <div class="step_title">
          <h1>Step 3. 신고서 작성</h1>
          <div class="border"></div>
        </div>

        <div class="error"></div>

        <div class="form_declare">
          <table>
            <colgroup>
              <col style="width: 30%" />
              <col style="width: 70%" />
            </colgroup>
            <tr>
              <td>기관명</td>
              <td><input type="text" readonly value="{{ organization.name }}" /></td>
            </tr>
            <tr>
              <td>제목</td>
              <td><input type="text" name="title" /></td>
            </tr>
            <tr>
              <td>누가</td>
              <td><input type="text" name="who" /></td>
            </tr>
            <tr>
              <td>언제</td>
              <td><input type="text" name="when" /></td>
            </tr>
            <tr>
              <td>어디서</td>
              <td><input type="text" name="where" /></td>
            </tr>
            <tr>
              <td>내용</td>
              <td><textarea name="content"></textarea></td>
            </tr>
            <tr>
              <td>이 문제를 아는 사람</td>
              <td><textarea name="witness"></textarea></td>
            </tr>
            <tr>
              <td>이 문제의 확인 방법</td>
              <td><textarea name="method"></textarea></td>
            </tr>
            <tr>
              <td>이 문제의 파악 경위</td>
              <td>
                <div class="input_radio">
                  <input type="radio" id="input_1_1" name="grasp" value="내게 일어난 일이라서" style="display:none;" />
                  <label for="input_1_1">내게 일어난 일이라서</label>
                  <div class="check_radio"></div>
                </div>
                <div class="input_radio">
                  <input type="radio" id="input_1_2" name="grasp" value="내가 직접 보거나 들은 일이라서" />
                  <label for="input_1_2">
                    내가 직접 보거나 들은 일이라서
                  </label>
                  <div class="check_radio"></div>
                </div>
                <div class="input_radio">
                  <input type="radio" id="input_1_3" name="grasp" value="직장 동료에게 들었음" />
                  <label for="input_1_3">직장 동료에게 들었음</label>
                  <div class="check_radio"></div>
                </div>
                <div class="input_radio">
                  <input type="radio" id="input_1_4" name="grasp" value="외부인에게 들었음" />
                  <label for="input_1_4">외부인에게 들었음</label>
                  <div class="check_radio"></div>
                </div>
                <div class="input_radio">
                  <input type="radio" id="input_1_5" name="grasp" value="소문으로 들었음" />
                  <label for="input_1_5">소문으로 들었음</label>
                  <div class="check_radio"></div>
                </div>
                <div class="input_radio">
                  <input type="radio" id="input_1_6" name="grasp" value="우연히 문서나 파일을 보다가 알게되었음" />
                  <label for="input_1_6">
                    우연히 문서나 파일을 보다가 알게되었음
                  </label>
                  <div class="check_radio"></div>
                </div>
              </td>
            </tr>
            <tr>
              <td>이 문제의 지속 기간</td>
              <td>
                <div class="input_radio">
                  <input type="radio" id="input_2_1" name="term" value="한 번" />
                  <label for="input_2_1">한 번</label>
                  <div class="check_radio"></div>
                </div>
                <div class="input_radio">
                  <input type="radio" id="input_2_2" name="term" value="일주일" />
                  <label for="input_2_2">일주일</label>
                  <div class="check_radio"></div>
                </div>
                <div class="input_radio">
                  <input type="radio" id="input_2_3" name="term" value="1-3 개월" />
                  <label for="input_2_3">1-3 개월</label>
                  <div class="check_radio"></div>
                </div>
                <div class="input_radio">
                  <input type="radio" id="input_2_4" name="term" value="3개월에서 1년" />
                  <label for="input_2_4">3개월에서 1년</label>
                  <div class="check_radio"></div>
                </div>
                <div class="input_radio">
                  <input type="radio" id="input_2_5" name="term" value="1년 이상" />
                  <label for="input_2_5">1년 이상</label>
                  <div class="check_radio"></div>
                </div>
              </td>
            </tr>
            <tr>
              <td>비밀번호</td>
              <td><input type="password" id="password" name="password" placeholder="8자 이상의 영문 대 소문자, 숫자, 특수문자를 사용해주세요." /></td>
            </tr>
<!---수정중-->
            <tr>
              <td>비밀번호 확인</td>
              <td><input type="password" id="re_password" name="re_password" placeholder="입력하신 비밀번호를 한번 더 입력해주세요." /></td>
            </tr>
<!---수정중-->

            <tr>
              <td>첨부파일</td>
              <td>
                <input type="file" name="file" multiple />
              </td>
            </tr>
            <tr>
              <td>주의사항</td>
              <td>
                신고서 ID는 분실시 재발급 or 재고지 불가<br />
                화면캡쳐 혹은 메모 요망 (신고서 ID는 본 신고서 제출후
                부여됨)<br />
                처리방법 및 기간은 조직에 따라 상이함<br />
                지속적인 신고내용확인 및 후속보고 필요
              </td>
            </tr>
            <tr>
              <td>약관동의</td>
              <td>
                <div class="input_checkbox">
                  <input type="checkbox" id="input_3_1" name="b" />
                  <label for="input_3_1">이 신고서를 작성하기 위한 용어 정의 및 이용약관에
                    동의합니다.</label>
                  <div class="check_checkbox"></div>
                </div>
              </td>
            </tr>
          </table>
        </div>
      </div>

      <div id="step_4" class="process_content">
        <div class="step_title">
          <h1>Step 4. 변호사 선택</h1>
          <div class="border"></div>
        </div>

        <div class="error"></div>

        <div class="lawyer_list">
          <div class="lawyer_search">
            <input type="text" name="search_lawyer" placeholder="변호사 또는 전문분야 입력">
            <button type="button" onclick="changeLawyerPage('initial')">검색</button>
          </div>
          <div class="lawyer_search_button">
            <div onclick="changeLawyerPage('minus')" class="lawyer_search_button_minus">◀</div>
            <div onclick="changeLawyerPage('plus')" class="lawyer_search_button_plus">▶</div>
          </div>
          <div id="lawyer_list">
            {% for lawyer in lawyers %}
            <div class="lawyer_item" id="{{ lawyer.id }}">
              <label for="lawyer_{{ lawyer.id }}">
                <div class="lawyer_detail">
                  <div class="lawyer_profile">
                    <img src="{{ lawyer.image.url }}" />
                  </div>
                  <div>
                    <h1>{{ lawyer.name }} 변호사</h1>
                    <p>{{ lawyer.introduce }}</p>
                    <div class="lawyer_fields">
                      {% for specialty in lawyer.speciality.all %}
                      <div>#{{ specialty }}</div>
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </label>
              <input type="radio" name="lawyer" id="lawyer_{{ lawyer.id }}" value="{{ lawyer.id }}" />
              <div class="check_lawyer_box"></div>
              <div class="lawyer_info_icon">
                <a href="https://naver.com" target="_blank">
                  <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="info-circle"
                    class="svg-inline--fa fa-info-circle fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 512 512">
                    <path fill="#4263eb"
                      d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z">
                    </path>
                  </svg>
                </a>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <div id="step_5" class="process_content">
        <div class="step_title">
          <h1>Step 5. 수임 요청</h1>
          <div class="border"></div>
        </div>

        <div class="lawyer_confirm">
          <div class="lawyer_confirm_title">선택한 변호사</div>
          <div class="lawyer_item lawyer_detail" id="lawyer_confirm"></div>

          <div class="declare_confirm_title">작성한 신고서</div>
          <div class="declare_confirm_table">
            <table>
              <colgroup>
                <col sytle="width: 30%" />
                <col style="width: 70%" />
              </colgroup>
              <tr>
                <td>기관명</td>
                <td>
                  <div class="declare_result">{{ organization.name }}</div>
                </td>
              </tr>
              <tr>
                <td>제목</td>
                <td>
                  <div name="title" class="declare_result"></div>
                </td>
              </tr>
              <tr>
                <td>누가</td>
                <td>
                  <div name="who" class="declare_result"></div>
                </td>
              </tr>
              <tr>
                <td>언제</td>
                <td>
                  <div name="when" class="declare_result"></div>
                </td>
              </tr>
              <tr>
                <td>어디서</td>
                <td>
                  <div name="where" class="declare_result"></div>
                </td>
              </tr>
              <tr>
                <td>내용</td>
                <td>
                  <div name="content" class="declare_result declare_result_textarea"></div>
                </td>
              </tr>
              <tr>
                <td>이 문제를 아는 사람</td>
                <td>
                  <div name="witness" class="declare_result declare_result_textarea"></div>
                </td>
              </tr>
              <tr>
                <td>이 문제의 확인 방법</td>
                <td>
                  <div name="method" class="declare_result declare_result_textarea"></div>
                </td>
              </tr>
              <tr>
                <td>이 문제의 파악 경위</td>
                <td>
                  <div name="grasp" class="declare_result"></div>
                </td>
              </tr>
              <tr>
                <td>이 문제의 지속 기간</td>
                <td>
                  <div name="term" class="declare_result"></div>
                </td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </form>

    <div class="step_button">
      <a id="prev" onclick="prevPage()" href="#process">이전</a>
      <a id="next" onclick="nextPage()" href="#process">다음</a>
    </div>
  </div>
</div>
{% endblock %}


{% block script_bottom %}
<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.1.5.js"></script>
<script src="http://dmaps.daum.net/map_js_init/postcode.v2.js"></script>
<script src="{% static 'helpline/js/cleave.min.js' %}"></script>
<script src="{% static 'helpline/js/cleave-phone.kr.js' %}"></script>
<script src="{% static 'helpline/js/report_new.js' %}"></script>
<script type="text/javascript">
  var flag = false,
    lawyerPage = 1;

  function changeLawyerPage(direction) {
    if (direction === "initial") {
      flag = false;
      lawyerPage = 1;
    } else if (direction === "plus") {
      if ("{{ lawyer_count }}" <= 5) return;
      if (!flag) lawyerPage += 1;
    } else if (direction === "minus") {
      if (lawyerPage <= 1) lawyerPage = 1;
      else {
        lawyerPage -= 1;
        flag = false;
      }
    }

    $.ajax({
      url: "{% url 'helpline:report_lawyer_list' %}",
      data: {
        page: lawyerPage,
        search_lawyer: document.querySelector("input[name='search_lawyer']").value
      },
      datatype: "json",
      success: function (data) {
        if (lawyerPage >= data.page_count) flag = true;

        let container = document.querySelector("#lawyer_list");
        let result = "";
        data['lawyers'].forEach(el => {
          let specialityList = "";
          el['speciality'].forEach(speciality => {
            specialityList += `<div>#${ speciality.name }</div>`
          });
          result += `
            <div class="lawyer_item" id="${el.id}">
              <label for="lawyer_${el.id}">
                <div class="lawyer_detail">
                  <div class="lawyer_profile">
                    <img src="${ el.image }" />
                  </div>
                  <div>
                    <h1>${ el.name } 변호사</h1>
                    <p>${ el.introduce }</p>
                    <div class="lawyer_fields">
                      ${ specialityList }
                    </div>
                  </div>
                </div>
              </label>
              <input
                type="radio"
                name="lawyer"
                id="lawyer_${ el.id }"
                value="${ el.id }"
              />
              <div class="check_lawyer_box"></div>
              <div class="lawyer_info_icon">
                <a href="https://naver.com" target="_blank">
                  <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="info-circle" class="svg-inline--fa fa-info-circle fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="#4263eb" d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"></path></svg>
                </a>
              </div>
            </div>
          `;
        });
        container.innerHTML = result;
      },
      error: function (data) {
        console.log(data.status);
      }
    });
  }
</script>
{% endblock %}